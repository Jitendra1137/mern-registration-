# 1Ô∏è‚É£ Build stage ‚Äì Node image for building React/Vite app
FROM node:20-alpine AS build

WORKDIR /app

# 2Ô∏è‚É£ Dependency files copy karo
COPY package*.json ./

# 3Ô∏è‚É£ Dependencies install karo
RUN npm install

# 4Ô∏è‚É£ Source code copy karo
COPY . .

# 5Ô∏è‚É£ ‚úÖ Build-time API URL pass karna
ARG VITE_API_URL
ENV VITE_API_URL=${VITE_API_URL}

# 6Ô∏è‚É£ ‚úÖ Optimized production build generate karo
RUN npm run build


# ============================
# 7Ô∏è‚É£ Final production stage ‚Äì Nginx
# ============================
FROM nginx:alpine

# 8Ô∏è‚É£ Default html folder clean
RUN rm -rf /usr/share/nginx/html/*

# 9Ô∏è‚É£ Build files ko Nginx ke html folder me copy
COPY --from=build /app/dist /usr/share/nginx/html

# üîü Public frontend port
EXPOSE 80

# 1Ô∏è‚É£1Ô∏è‚É£ Nginx start
CMD ["nginx", "-g", "daemon off;"]
